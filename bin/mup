#!/usr/bin/env node
var path = require('path');
var cjson = require('cjson');
var Config = require('../lib/config');
var ActionsRegistry = require('../lib/actions');
require('colors');

console.log('\nMeteor-UP : Production Quality Meteor Deployments'.bold.blue);
console.log('--------------------------------------------------\n'.bold.blue);

var action = process.argv[2];
if(action == 'init') {
  //special setup for init
  ActionsRegistry.init();
} else {
  var cwd = path.resolve('.');
  var config = Config.read();

  //validate config
  var actionsRegistry = new ActionsRegistry(config, cwd);

  if(actionsRegistry[action]) {
    actionsRegistry[action]();
  } else {
    var errorMessage = 'No Such Action Exists: ' + action;
    console.error(errorMessage.bold.red);
    console.error('\nValid Actions');
    console.error('-------------');
    console.error('init           - initialize a Meteor-Up project');
    console.error('setup          - setup the server');
    console.error('deploy         - deploy app to server');
    console.error('logs [-f -n ]  - access logs');
  }
}
